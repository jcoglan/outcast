/*
Copyright (c) 2007-2008 the OTHER media Limited
Licensed under the BSD license, http://ojay.othermedia.org/license.html
Version: master-7bf74da460c9904c4a2bacfa7d728df9748fb7d2
Build:   min
*/

Ojay.History=(function(h){var i={'?':'--Qq--','=':'--Ee--','&':'--Aa--','_':'--Uu--','/':'--Ss--'},l=function(a){var c=encodeURIComponent(j(a));for(var b in i)c=c.replace(b,i[b]);return c},j=function(a){a=decodeURIComponent(String(a));for(var c in i)a=a.replace(i[c],c);return a},n=function(a){if(typeof a!='string')return a;if((/^\-?\d+(?:\.\d+)?$/.test(a)))a=Number(a);var c={'true':true,'false':false,'undefined':undefined,'null':null};for(var b in c){if(a==b)a=c[b]}return a},m=function(a){if(!a)return'';var c=[];for(var b in a)c.push(l(b)+'_'+l(a[b]));return c.join('/')},k=function(a){a=String(a).replace(/^\s*(.*?)\s*$/,'$1');if(!a)return{};var c=a.split('/'),b,g={},e;for(var f=0,d=c.length;f<d;f++){b=c[f].split('_');e=n(j(b[1]));g[j(b[0])]=e}return g};return{INTERFACE:new JS.Interface(['getInitialState','changeState']),manage:function(b,g){JS.Interface.ensure(b,this.INTERFACE);var e=String(g);var f=b.changeState.functionize();var d={};b.getInitialState=b.getInitialState.wrap(function(a){d=h.getBookmarkedState(e);if(d)d=k(d);else d=a();return d});b.changeState=function(a){a=a||{};for(var c in a)d[c]=a[c];a=m(d);h.navigate(e,a)};var o=m(b.getInitialState());h.register(e,o,function(a){a=k(a);f(b,a)});h.onLoadEvent.subscribe(function(){var a=h.getCurrentState(e);a=k(a);f(b,a)})},initialize:function(a){a=a||{};var c=(a.asset||'/robots.txt').replace(/^http:\/\/[^\/]*/ig,'');var b=a.inputID||'yui-history-field';var g=a.iframeID||'yui-history-iframe';var e=Ojay(document.body),f,d;f=Ojay.HTML.input({type:'hidden',id:b});e.insert(f,'top');d=Ojay.HTML.iframe({id:g,src:c});Ojay(d).setStyle({position:'absolute',top:0,left:0,width:'1px',height:'1px',visibility:'hidden'});e.insert(d,'top');h.initialize(b,g)}}})(YAHOO.util.History);